# LevelDB analysis
## Introduction ([PPT](./[analysis]analysis_introduction_week5.pdf))
1. Analysis Tools 
2. Where to start?
3. Source Code
4. Important Functions
5. Code Flow
7. Watermark
8. Draw figure with PPT




## Topics
| Topic        | User API         | Internal Operation    | Contents                                                | Source Code                                                    |PPT|
|--------------|------------------|-----------------------|---------------------------------------------------------|----------------------------------------------------------------|--|
| WAL/Manifest | Put              | Open </br>Flush </br>Compaction | Version Control </br>Log Format </br>Manifest Format             | log_*.h </br>version_*.h </br>db_impl.h </br>repair.cc                        |Week5|
| Memtable     | Put </br>Get </br>Iterator | Flush                 | Skiplist </br>Arena </br>Batch Write                              | wirte_batch_internal.h </br>skiplist.h </br>memtable.h </br>db_impl.h </br>arena.h |Week5|
| Compaction   | Put              | Compaction            | Compaction Policy </br>Merge Iterator                        | db_impl.h </br>merger.h </br>version_set.h                               |Week5|
| SSTable      | Get </br>Iterator     | Flush </br>Compaction      | SST Format </br>Block Format                                 | table/ </br>builder.h                                               |Week5|
| Bloom filter | Put </br>Get          | Flush </br>Compaction      | Meta Index Block </br>Filter Block </br>Bloom Filter              | bloom.cc </br>filter_block.cc </br>filter_policy.h                       |Week5|
| Cache        | Get </br>Iterator    |                       | Replacement Policy </br>Sharding, Lock </br>Hash </br>Index/Data Block | cache.h </br>table.cc </br>table_cache.h </br>hash.h </br>db_impl.h                |[Week5]([analysis]cache_week5.pdf)|


## Functions
| **WAL/Manifest**  <img width=320/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    | **Memtable**       <img width=320/>                                                                                                                                                                                                                                                                                                                                                                                       |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| leveldb::log::Writer::AddRecord </br>leveldb::_GLOBAL__N_1::PosixWritableFile::Append </br>leveldb::log::Writer::EmitPhysicalRecord </br>leveldb::VersionSet::PickCompaction </br>leveldb::VersionSet::LogAndApply </br>leveldb::VersionSet::AppendVersion </br>leveldb::VersionSet::NeedsCompaction </br>leveldb::VersionEdit::VersionEdit </br>leveldb::Version::OverlapInLevel </br>leveldb::DBImpl::MaybeScheduleCompaction </br>leveldb::DBImpl::InstallCompactionResults </br>leveldb::_GLOBAL__N_1::PosixWritableFile::SyncFd </br>leveldb::_GLOBAL__N_1::PosixEnv::RemoveFile | leveldb::Version::PickLevelForMemTableOutput </br>leveldb::DBImpl::CompactMemTable </br>leveldb::DBImpl::WriteLevel0Table </br>leveldb::SkipList::RandomHeight </br>leveldb::SkipList::NewNode </br>leveldb::SkipList::Equal </br>leveldb::SkipList::Node::SetNext </br>leveldb::SkipList::Iterator </br>leveldb::Arena::MemoryUsage </br>leveldb::Arena::AllocateNewBlock </br>leveldb::Arena::~Arena |

| **Compaction**      <img width=320/>                                                                                                                                                                                                                                                                                                                                                             | **SSTable**        <img width=320/>                                                                                                                                                                                                                                                                                                                                                                                                                             |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| leveldb::DBImpl::BGWork </br>leveldb::DBImpl::DoCompactionWork </br>leveldb::DBImpl::FinishCompactionOutputFile </br>leveldb::DBImpl::InstallCompactionResults </br>leveldb::DBImpl::CleanupCompaction </br>leveldb::NewTwoLevelIterator </br>leveldb::NewMergingIterator </br>leveldb::_GLOBAL__N_1::MergingIterator::SeekToFirst </br>leveldb::_GLOBAL__N_1::MergingIterator::key | leveldb::ReadBlock </br>leveldb::TableBuilder::Add  </br>leveldb::TableBuilder::Flush </br>leveldb::TableBuilder::WriteBlock </br>leveldb::port::Snappy_Compress </br>leveldb::_GLOBAL__N_1::HandleTable::Lookup </br>leveldb::_GLOBAL__N_1::PosixMmapReadableFile::Read  </br>leveldb::_GLOBAL__N_1::TwoLevelIterator::InitDataBlock </br>leveldb::_GLOBAL__N_1::PosixWritableFile::Append </br>leveldb::_GLOBAL__N_1::PosixWritableFile::Sync |

| **Bloom Filter**                   <img width=320/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              | **Cache**                  <img width=320/>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| leveldb::Table::ReadFilter </br>leveldb::FilterBlockBuilder::Finish </br>leveldb::FilterBlockBuilder::StartBlock </br>leveldb::FilterBlockBuilder::GenerateFilter </br>leveldb::FilterBlockBuilder::FilterBlockBuilder </br>leveldb::FilterBlockBuilder::AddKey </br>leveldb::FilterBlockReader::KeyMayMatch </br>leveldb::_GLOBAL__N_1::BloomFilterPolicy::KeyMayMatch </br>leveldb::FilterBlockReader::FilterBlockReader </br>leveldb::_GLOBAL__N_1::BloomHash </br>leveldb::_GLOBAL__N_1::BloomFilterPolicy::CreateFilter </br>leveldb::_GLOBAL__N_1::BloomFilterPolicy::Name | leveldb::TableCache::FindTable </br>leveldb::DeleteCachedBlock </br>leveldb::_GLOBAL__N_1::LRUCache::Release </br>leveldb::_GLOBAL__N_1::LRUCache::LRU_Remove </br>leveldb::_GLOBAL__N_1::LRUCache::LRU_Append </br>leveldb::_GLOBAL__N_1::LRUCache::FinishErase </br>leveldb::_GLOBAL__N_1::LRUCache::Unref </br>leveldb::_GLOBAL__N_1::ShardedLRUCache::Shard </br>leveldb::_GLOBAL__N_1::ShardedLRUCache::Lookup </br>leveldb::_GLOBAL__N_1::ShardedLRUCache::Insert </br>leveldb::_GLOBAL__N_1::PosixMmapReadableFile::Read |


## Notice
* Upload your presentation file through pull reqeust.
    - Pull request until **every Tuesday, 11AM**.
    - Title: [analysis]topic_week0.pdf
    - [presentation.ppt](../file/%5Bformat%5Dleveldb_study_ppt.pptx)   
    
* Upload your analysis document at [DKU-StarLab/leveldb-wiki](https://github.com/DKU-StarLab/leveldb-wiki) repository through pull reqeust.
    - Pull request until **every Tuesday, 11AM**.
* Check previous study presentation files.
    - https://github.com/DKU-StarLab/RocksDB_Festival
